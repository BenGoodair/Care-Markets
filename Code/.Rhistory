# Panel 1: Half‑eye plots of OR distributions (unchanged)
p1_need <- ggplot(or_need,  aes(x = OR, y = label, fill = label)) +
stat_halfeye(.width = c(0.5,0.95), slab_alpha = 0.8, slab_size = 1) +
geom_vline(xintercept = 1, linetype = "dashed") +
scale_x_continuous(trans = "log10", labels = label_number()) +
scale_fill_manual(values = c(
"Investment owned" = "#D32F2F",
"Corporate owned"  = "#757575",
"Individual owned" = "#757575",
"Third sector"     = "#757575"
), guide = "none") +
labs(title = "A) Odds Ratios: Area Need",
subtitle = "Reference: Local Authority",
x = "Odds Ratio", y = "Sector") +
theme_bw(base_size = 12) +
coord_cartesian(xlim = c(0.1, 3))
p2 <- ggplot(df_need_sum, aes(x = need, y = median, color = label)) +
# 95% CI
geom_errorbar(aes(ymin = lower95, ymax = upper95),
position = position_dodge(width = 0.5),
width = 0.2) +
# 50% CI (thicker)
geom_errorbar(aes(ymin = lower50, ymax = upper50),
position = position_dodge(width = 0.5),
width = 0.4, size = 1.2) +
geom_point(position = position_dodge(width = 0.5), size = 3) +
labs(title    = "B) Predicted Probability by Area Need",
subtitle = "(holding number of children at average and closure status as open)",
x        = "Area Need",
y        = "Probability",
color = "Ownership") +
scale_color_manual(values = sector_colors) +
theme_bw(base_size = 12) +
theme(legend.position = "none")
com <- ggplot(changeplot, aes(x = month, y = cumulative_homes, color = needQuint)) +
geom_line(size = 1.5) +
labs(
title = "Commercial homes opened by area need",
subtitle = "Commercial = Individual, Corporate and Investment owned",
x = NULL,
y = "Cumulative new homes opened",
color = "Area Need\n(Net loss, Quintile)"
) +
theme_bw() +
scale_color_viridis_d(option = "viridis") +
theme(
legend.position = "none",
plot.title = element_text(face = "bold", size = 12)
)
# Combine panels
final <- p1_need / p2 /com/non_com
final
non_com <- ggplot(changeplot, aes(x = month, y = cumulative_homes, color = needQuint)) +
geom_line(size = 1.5) +
labs(
title = "Non-commercial homes opened by area need",
subtitle = "Non-commercial = Local Authority and Third sector",
x = NULL,
y = "Cumulative new homes opened",
color = "Area Need\n(Net loss, Quintile)"
) +
theme_bw() +
scale_color_viridis_d(option = "viridis") +
theme(
legend.position = "bottom",
plot.title = element_text(face = "bold", size = 12)
)
changeplot <- mlm %>%
dplyr::select(Registration.date, Sector_merge, Local.authority, Join) %>%
left_join(., mlm %>%
dplyr::select(Local.authority, net_loss_s) %>%
dplyr::distinct(.keep_all = TRUE) %>%
dplyr::mutate(needQuint = factor(ntile(net_loss_s, 5))) %>%
dplyr::select(-net_loss_s)
) %>%
mutate(location_start = dmy(Registration.date),
location_start = ifelse(is.na(location_start), Join, as.character(location_start)),
location_start = as.Date(location_start))%>%
filter(location_start >= as.Date("2014-03-01"),
Sector_merge == "Local Authority"|Sector_merge == "Third sector",
!is.na(needQuint)) %>%
mutate(month = floor_date(location_start, "month")) %>%
group_by(month, needQuint) %>%
summarise(new_care_homes = n(), .groups = "drop") %>%
complete(
month = seq(min(month), max(month), by = "month"),
needQuint = unique(needQuint),
fill = list(new_care_homes = 0)
) %>%
group_by(needQuint) %>%
arrange(month) %>%
mutate(cumulative_homes = cumsum(new_care_homes),
needQuint = case_when(
needQuint == 5 ~ "5 (High need)",
needQuint == 4 ~ "4",
needQuint == 3 ~ "3",
needQuint == 2 ~ "2",
needQuint == 1 ~ "1 (Low need)"
))
zero_rows <- changeplot %>%
group_by(needQuint) %>%
summarise(month = min(month) - months(1), cumulative_homes = 0, .groups = "drop") %>%
mutate(new_care_homes = 0)
changeplot <- bind_rows(changeplot, zero_rows) %>%
arrange(needQuint, month)
non_com <- ggplot(changeplot, aes(x = month, y = cumulative_homes, color = needQuint)) +
geom_line(size = 1.5) +
labs(
title = "Non-commercial homes opened by area need",
subtitle = "Non-commercial = Local Authority and Third sector",
x = NULL,
y = "Cumulative new homes opened",
color = "Area Need\n(Net loss, Quintile)"
) +
theme_bw() +
scale_color_viridis_d(option = "viridis") +
theme(
legend.position = "bottom",
plot.title = element_text(face = "bold", size = 12)
)
changeplot <- mlm %>%
dplyr::select(Registration.date, Sector_merge, Local.authority, Join) %>%
left_join(., mlm %>%
dplyr::select(Local.authority, net_loss_s) %>%
dplyr::distinct(.keep_all = TRUE) %>%
dplyr::mutate(needQuint = factor(ntile(net_loss_s, 5))) %>%
dplyr::select(-net_loss_s)
) %>%
mutate(location_start = dmy(Registration.date),
location_start = ifelse(is.na(location_start), Join, as.character(location_start)),
location_start = as.Date(location_start))%>%
filter(location_start >= as.Date("2014-03-01"),
Sector_merge == "Individual owned"|Sector_merge == "Corporate owned"|Sector_merge == "Investment owned",
!is.na(needQuint)) %>%
mutate(month = floor_date(location_start, "month")) %>%
group_by(month, needQuint) %>%
summarise(new_care_homes = n(), .groups = "drop") %>%
complete(
month = seq(min(month), max(month), by = "month"),
needQuint = unique(needQuint),
fill = list(new_care_homes = 0)
) %>%
group_by(needQuint) %>%
arrange(month) %>%
mutate(cumulative_homes = cumsum(new_care_homes),
needQuint = case_when(
needQuint == 5 ~ "5 (High need)",
needQuint == 4 ~ "4",
needQuint == 3 ~ "3",
needQuint == 2 ~ "2",
needQuint == 1 ~ "1 (Low need)"
))
zero_rows <- changeplot %>%
group_by(needQuint) %>%
summarise(month = min(month) - months(1), cumulative_homes = 0, .groups = "drop") %>%
mutate(new_care_homes = 0)
changeplot <- bind_rows(changeplot, zero_rows) %>%
arrange(needQuint, month)
com <- ggplot(changeplot, aes(x = month, y = cumulative_homes, color = needQuint)) +
geom_line(size = 1.5) +
labs(
title = "Commercial homes opened by area need",
subtitle = "Commercial = Individual, Corporate and Investment owned",
x = NULL,
y = "Cumulative new homes opened",
color = "Area Need\n(Net loss, Quintile)"
) +
theme_bw() +
scale_color_viridis_d(option = "viridis") +
theme(
legend.position = "none",
plot.title = element_text(face = "bold", size = 12)
)
# Combine panels
final <- p1_need / p2 /com/non_com
final
p2 <- ggplot(df_need_sum, aes(x = need, y = median, color = label)) +
# 95% CI
geom_errorbar(aes(ymin = lower95, ymax = upper95),
position = position_dodge(width = 0.5),
width = 0.2) +
# 50% CI (thicker)
geom_errorbar(aes(ymin = lower50, ymax = upper50),
position = position_dodge(width = 0.5),
width = 0.4, size = 1.2) +
geom_point(position = position_dodge(width = 0.5), size = 3) +
labs(title    = "B) Predicted Probability by Area Need",
subtitle = "(holding number of children at average and closure status as open)",
x        = "Area Need",
y        = "Probability",
color = "Ownership") +
scale_color_manual(values = sector_colors) +
theme_bw(base_size = 12) +
theme(legend.position = "bottom",
plot.title = element_text(face = "bold", size = 12)
)
# Panel 1: Half‑eye plots of OR distributions (unchanged)
p1_need <- ggplot(or_need,  aes(x = OR, y = label, fill = label)) +
stat_halfeye(.width = c(0.5,0.95), slab_alpha = 0.8, slab_size = 1) +
geom_vline(xintercept = 1, linetype = "dashed") +
scale_x_continuous(trans = "log10", labels = label_number()) +
scale_fill_manual(values = c(
"Investment owned" = "#D32F2F",
"Corporate owned"  = "#757575",
"Individual owned" = "#757575",
"Third sector"     = "#757575"
), guide = "none") +
labs(title = "A) Odds Ratios: Area Need",
subtitle = "Reference: Local Authority",
x = "Odds Ratio", y = "Sector") +
theme_bw(base_size = 12) +
coord_cartesian(xlim = c(0.1, 3))+
theme(        plot.title = element_text(face = "bold", size = 12))
# Combine panels
final <- p1_need / p2 /com/non_com
final
changeplot <- mlm %>%
dplyr::select(Registration.date, Sector_merge, Local.authority, Join) %>%
left_join(., mlm %>%
dplyr::select(Local.authority, net_loss_s) %>%
dplyr::distinct(.keep_all = TRUE) %>%
dplyr::mutate(needQuint = factor(ntile(net_loss_s, 5))) %>%
dplyr::select(-net_loss_s)
) %>%
mutate(location_start = dmy(Registration.date),
location_start = ifelse(is.na(location_start), Join, as.character(location_start)),
location_start = as.Date(location_start))%>%
filter(location_start >= as.Date("2014-03-01"),
Sector_merge == "Local Authority"|Sector_merge == "Third sector",
!is.na(needQuint)) %>%
mutate(month = floor_date(location_start, "month")) %>%
group_by(month, needQuint) %>%
summarise(new_care_homes = n(), .groups = "drop") %>%
complete(
month = seq(min(month), max(month), by = "month"),
needQuint = unique(needQuint),
fill = list(new_care_homes = 0)
) %>%
group_by(needQuint) %>%
arrange(month) %>%
mutate(cumulative_homes = cumsum(new_care_homes),
needQuint = case_when(
needQuint == 5 ~ "5 (High need)",
needQuint == 4 ~ "4",
needQuint == 3 ~ "3",
needQuint == 2 ~ "2",
needQuint == 1 ~ "1 (Low need)"
))
zero_rows <- changeplot %>%
group_by(needQuint) %>%
summarise(month = min(month) - months(1), cumulative_homes = 0, .groups = "drop") %>%
mutate(new_care_homes = 0)
changeplot <- bind_rows(changeplot, zero_rows) %>%
arrange(needQuint, month)
non_com <- ggplot(changeplot, aes(x = month, y = cumulative_homes, color = needQuint)) +
geom_line(size = 1.5) +
labs(
title = "D) Non-commercial homes opened by area need",
subtitle = "Non-commercial = Local Authority and Third sector",
x = NULL,
y = "Cumulative new homes opened",
color = "Area Need\n(Net loss, Quintile)"
) +
theme_bw() +
scale_color_viridis_d(option = "viridis") +
theme(
legend.position = "bottom",
plot.title = element_text(face = "bold", size = 12)
)
changeplot <- mlm %>%
dplyr::select(Registration.date, Sector_merge, Local.authority, Join) %>%
left_join(., mlm %>%
dplyr::select(Local.authority, net_loss_s) %>%
dplyr::distinct(.keep_all = TRUE) %>%
dplyr::mutate(needQuint = factor(ntile(net_loss_s, 5))) %>%
dplyr::select(-net_loss_s)
) %>%
mutate(location_start = dmy(Registration.date),
location_start = ifelse(is.na(location_start), Join, as.character(location_start)),
location_start = as.Date(location_start))%>%
filter(location_start >= as.Date("2014-03-01"),
Sector_merge == "Individual owned"|Sector_merge == "Corporate owned"|Sector_merge == "Investment owned",
!is.na(needQuint)) %>%
mutate(month = floor_date(location_start, "month")) %>%
group_by(month, needQuint) %>%
summarise(new_care_homes = n(), .groups = "drop") %>%
complete(
month = seq(min(month), max(month), by = "month"),
needQuint = unique(needQuint),
fill = list(new_care_homes = 0)
) %>%
group_by(needQuint) %>%
arrange(month) %>%
mutate(cumulative_homes = cumsum(new_care_homes),
needQuint = case_when(
needQuint == 5 ~ "5 (High need)",
needQuint == 4 ~ "4",
needQuint == 3 ~ "3",
needQuint == 2 ~ "2",
needQuint == 1 ~ "1 (Low need)"
))
zero_rows <- changeplot %>%
group_by(needQuint) %>%
summarise(month = min(month) - months(1), cumulative_homes = 0, .groups = "drop") %>%
mutate(new_care_homes = 0)
changeplot <- bind_rows(changeplot, zero_rows) %>%
arrange(needQuint, month)
com <- ggplot(changeplot, aes(x = month, y = cumulative_homes, color = needQuint)) +
geom_line(size = 1.5) +
labs(
title = "C) Commercial homes opened by area need",
subtitle = "Commercial = Individual, Corporate and Investment owned",
x = NULL,
y = "Cumulative new homes opened",
color = "Area Need\n(Net loss, Quintile)"
) +
theme_bw() +
scale_color_viridis_d(option = "viridis") +
theme(
legend.position = "none",
plot.title = element_text(face = "bold", size = 12)
)
# Combine panels
final <- p1_need / p2 /com/non_com
final
# Panel 1: Half‑eye plots of OR distributions (unchanged)
p1_need <- ggplot(or_need,  aes(x = OR, y = label, fill = label)) +
stat_halfeye(.width = c(0.5,0.95), slab_alpha = 0.8, slab_size = 1) +
geom_vline(xintercept = 1, linetype = "dashed") +
scale_x_continuous(trans = "log10", labels = label_number()) +
scale_fill_manual(values = c(
"Investment owned" = "#5B0000",
"Corporate owned"  = "#FF5E5E",
"Individual owned" = "#E4007C",
"Third sector"     = "#F0AB00"
), guide = "none") +
labs(title = "A) Odds Ratios: Area Need",
subtitle = "Reference: Local Authority",
x = "Odds Ratio", y = "Sector") +
theme_bw(base_size = 12) +
coord_cartesian(xlim = c(0.1, 3))+
theme(        plot.title = element_text(face = "bold", size = 12))
n
# Combine panels
final <- p1_need / p2 /com/non_com
final
# Panel 1: Half‑eye plots of OR distributions (unchanged)
p1_need <- ggplot(or_need,  aes(x = OR, y = label, fill = label)) +
stat_halfeye(.width = c(0.5,0.95), slab_alpha = 0.8, slab_size = 1) +
geom_vline(xintercept = 1, linetype = "dashed") +
scale_x_continuous(trans = "log10", labels = label_number()) +
scale_fill_manual(values = c(
"Investment owned" = "#5B0000",
"Corporate owned"  = "#FF5E5E",
"Individual owned" = "#E4007C",
"Third sector"     = "#F0AB00"
), guide = "none") +
labs(title = "A) Odds ratios of ownership by area need",
subtitle = "Reference: Local Authority",
x = "Odds Ratio", y = "Sector") +
theme_bw(base_size = 12) +
coord_cartesian(xlim = c(0.1, 3))+
theme(        plot.title = element_text(face = "bold", size = 12))
p2 <- ggplot(df_need_sum, aes(x = need, y = median, color = label)) +
# 95% CI
geom_errorbar(aes(ymin = lower95, ymax = upper95),
position = position_dodge(width = 0.5),
width = 0.2) +
# 50% CI (thicker)
geom_errorbar(aes(ymin = lower50, ymax = upper50),
position = position_dodge(width = 0.5),
width = 0.4, size = 1.2) +
geom_point(position = position_dodge(width = 0.5), size = 3) +
labs(title    = "B) Predicted probability of ownership by area need",
subtitle = "(holding number of children at average and closure status as open)",
x        = "Area Need",
y        = "Probability",
color = "Ownership") +
scale_color_manual(values = sector_colors) +
theme_bw(base_size = 12) +
theme(legend.position = "bottom",
plot.title = element_text(face = "bold", size = 12)
)
# Combine panels
final <- p1_need / p2 /com/non_com
final
p2 <- ggplot(df_need_sum, aes(x = need, y = median, color = label)) +
# 95% CI
geom_errorbar(aes(ymin = lower95, ymax = upper95),
position = position_dodge(width = 0.5),
width = 0.2) +
# 50% CI (thicker)
geom_errorbar(aes(ymin = lower50, ymax = upper50),
position = position_dodge(width = 0.5),
width = 0.4, size = 1.2) +
geom_point(position = position_dodge(width = 0.5), size = 3) +
labs(title    = "B) Predicted probability of ownership by area need",
subtitle = "(holding number of children at average and closure status as open)",
caption = "High need defined as a net loss 1.5 SD above mean; Low need defined as a net loss 1.5 SD below mean"
x        = "Area Need",
p2 <- ggplot(df_need_sum, aes(x = need, y = median, color = label)) +
# 95% CI
geom_errorbar(aes(ymin = lower95, ymax = upper95),
position = position_dodge(width = 0.5),
width = 0.2) +
# 50% CI (thicker)
geom_errorbar(aes(ymin = lower50, ymax = upper50),
position = position_dodge(width = 0.5),
width = 0.4, size = 1.2) +
geom_point(position = position_dodge(width = 0.5), size = 3) +
labs(title    = "B) Predicted probability of ownership by area need",
subtitle = "(holding number of children at average and closure status as open)",
caption = "High need defined as a net loss 1.5 SD above mean; Low need defined as a net loss 1.5 SD below mean",
x        = "Area Need",
y        = "Probability",
color = "Ownership") +
scale_color_manual(values = sector_colors) +
theme_bw(base_size = 12) +
theme(legend.position = "bottom",
plot.title = element_text(face = "bold", size = 12)
)
# Combine panels
final <- p1_need / p2 /com/non_com
# Combine panels
final <- p1_need / p2 /com/non_com
p2 <- ggplot(df_need_sum, aes(x = need, y = median, color = label)) +
# 95% CI
geom_errorbar(aes(ymin = lower95, ymax = upper95),
position = position_dodge(width = 0.5),
width = 0.2) +
# 50% CI (thicker)
geom_errorbar(aes(ymin = lower50, ymax = upper50),
position = position_dodge(width = 0.5),
width = 0.4, size = 1.2) +
geom_point(position = position_dodge(width = 0.5), size = 3) +
labs(title    = "B) Predicted probability of ownership by area need",
subtitle = "(holding number of children at average and closure status as open)",
caption = "High need defined as a net loss 1.5 SD above mean; Low need defined as a net loss 1.5 SD below mean",
x        = "Area Need",
y        = "Probability",
color = "Ownership") +
scale_color_manual(values = sector_colors) +
theme_bw(base_size = 12) +
theme(legend.position = "bottom",
plot.title = element_text(face = "bold", size = 12)
)
p2
# Combine panels
final <- p1_need / p2 /com/non_com
final
# Panel 1: Half‑eye plots of OR distributions (unchanged)
p1_need <- ggplot(or_need,  aes(x = OR, y = label, fill = label)) +
stat_halfeye(.width = c(0.5,0.95), slab_alpha = 0.8, slab_size = 1) +
geom_vline(xintercept = 1, linetype = "dashed") +
#scale_x_continuous(trans = "log10", labels = label_number()) +
scale_fill_manual(values = c(
"Investment owned" = "#5B0000",
"Corporate owned"  = "#FF5E5E",
"Individual owned" = "#E4007C",
"Third sector"     = "#F0AB00"
), guide = "none") +
labs(title = "A) Odds ratios of ownership by area need",
subtitle = "Reference: Local Authority",
x = "Odds Ratio", y = "Sector") +
theme_bw(base_size = 12) +
coord_cartesian(xlim = c(0.1, 3))+
theme(        plot.title = element_text(face = "bold", size = 12))
# Combine panels
final <- p1_need / p2 /com/non_com
final
or_need
View(or_need)
# Panel 1: Half‑eye plots of OR distributions (unchanged)
p1_need <- ggplot(or_need,  aes(x = OR, y = label, fill = label)) +
stat_halfeye(.width = c(0.5,0.95), slab_alpha = 0.8, slab_size = 1) +
geom_vline(xintercept = 1, linetype = "dashed") +
#scale_x_continuous(trans = "log10", labels = label_number()) +
scale_fill_manual(values = c(
"Investment owned" = "#5B0000",
"Corporate owned"  = "#FF5E5E",
"Individual owned" = "#E4007C",
"Third sector"     = "#F0AB00"
), guide = "none") +
labs(title = "A) Odds ratios of ownership by area need",
subtitle = "Reference: Local Authority",
x = "Odds Ratio", y = "Sector") +
theme_bw(base_size = 12) +
coord_cartesian(xlim = c(0.2, 2))+
theme(        plot.title = element_text(face = "bold", size = 12))
# Combine panels
final <- p1_need / p2 /com/non_com
final
# Panel 1: Half‑eye plots of OR distributions (unchanged)
p1_need <- ggplot(or_need,  aes(x = OR, y = label, fill = label)) +
stat_halfeye(.width = c(0.5,0.95), slab_alpha = 0.8, slab_size = 1) +
geom_vline(xintercept = 1, linetype = "dashed") +
scale_x_continuous(trans = "log10", labels = label_number()) +
scale_fill_manual(values = c(
"Investment owned" = "#5B0000",
"Corporate owned"  = "#FF5E5E",
"Individual owned" = "#E4007C",
"Third sector"     = "#F0AB00"
), guide = "none") +
labs(title = "A) Odds ratios of ownership by area need",
subtitle = "Reference: Local Authority",
x = "Odds Ratio", y = "Sector") +
theme_bw(base_size = 12) +
coord_cartesian(xlim = c(0.2, 2))+
theme(        plot.title = element_text(face = "bold", size = 12))
# Combine panels
final <- p1_need / p2 /com/non_com
final
